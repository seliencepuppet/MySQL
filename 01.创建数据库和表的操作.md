用户连接请求
|
连接管理器
|
线程管理器
|
用户模块（管理用户连接的）    
|
日志  ------------------- 命令分发模块 -------------  告诉缓存模块  ---- （缓存管理器）
|                        
解析器
|
|
repair 
优化器   表定义  表维护     状态报告  复制
模块       模块        模块      模块
|           |            |             |            |                
|           |            |             |            |                       
|           |            |             |            |               
访问控制模块            
|      
表管理器
|
存储引擎





表管理器：负责创建，读取或修改表定义文件
表结构定义文件

表修改模块：创建表，删除，重命名，移除，更新或插入之类的操作
表维护模块：检查， 修改， 备份， 恢复， 优化（碎片整理）及解析


文件中记录组织：
堆文件组织：一条记录可以放在文件中的任何地方
顺序文件组织：根据"搜索码"值顺序存放
散列文件组织：



MySQL特性

Speed  
完全多线程
查询缓存

Reliability
Scalability （伸缩性）
Ease of use
Portability and Standards Compliance
Multiuser Support
Internationalization
Wide Application Support
C C++ java perl PHP Python Ruby
JDBC ODBC 


MySQL Server （mysqld，mysql）                         
MySQL Cluster
MySQL Proxy
MySQL administrator
MySQL Query Browser
MySQL Workbench
MySQL Migration Toolkit
MySQL Embedded Server
MySQL Drivers and Connextors



Contribute to MySQL server

Blogging
Mailing lists
User groups
Documentation
Code
MySQL Magazine


MySQL
MariaDB
Percona

MySQL的常用安装
专用的软件包管理器包
deb， rpm
rpm：
RHEL（Oracle linux） CentOS
SUSE
通用二进制格式包
gcc：x86， x64
源代码
5.1，  5.5 ， 5.6
cmake  （跨平台的编译器）



bin

data

include
lib
man
mysql-test
scripts             
share                   语言共享库（每一种语言相关的不同版本）
sql-bench               基准测试（能够测试mysql服务器安装完成后的负载能力）
support-files           


/etc/my.cnf
/etc/mysql/my.cnf
$MYSQL_HOME/my.cnf
/path/to/file when defaults-extra-file=/path/to/
~/.my.cnf

MySQL 用户密码修改：
1. # mysqladmin -u USERNAME -H HOSTNAME password 'new_password' -p
2. mysql> SET PASSWORD FRO 'USERNAME'@'HOST'=PASSWORD('new_pass');
3. mysql> UPDATE mysql.user SET PASSWORD=PASSWORD('new_pass') WHERE CONDITION;
4. mysql> flush privileges;


安装一个mysql  功能使用

原码安装mysql

1.使用cmake编译mysql-5.5
cmake 指定编译选项的方式不同于make， 实现方式对比如下：
./configure         cmake . 
./configure --help    cmake . -LAH  or  ccmake . 

指定安装文件的安装路径时常用的选项：
-DCMAKE_INSTALL_PREFIX=/usr/local/mysql
-DMYSQL_DATADIR=/data/mysql
-DSYSCONFDIR=/etc

默认编译的存储引擎包括： csv， myisam， myisamerg 和 help
若要安装其他存储引擎，可以使用
类似如下编译选项：

-DWITH_INNOBASE_STORAGE_ENGINE = 1
-DWITH_ARCHIVE_STORAGE_ENGINE = 1
-DWITH_BLACKHOLE_STORAGE_ENGINE = 1
-DWITH_FEDERATED_STORAGE_ENGINE = 1

若要明确指定不编译某存储引擎，可以使用类似如下的选项
-DWITHOUT_<ENGINE>_STORAGE_ENGINE = 1
比如：
-DWITHOUT_EXAMPLE_STORAGE_ENGINE = 1
-DWITHOUT_FEDERATED_STORAGE_ENGINE = 1
-DWITHOUT_PARTITION_STORAGE_ENGINE = 1

如若要编译进其它功能，如ssl 等， 则可使用类似如下选项来实现编译时
使用某库或不使用某库
-DWITH_TCP_PORT = 3306
-DMYSQL_UNIX_ADDR = /tmp/mysql.sock
-DENABLED_LOCAL_INFILE = 1
-DEXTRA_CHARSETS = all
-DDEFAULT_CHARSET = utf8
-DDEFAULT_COLLATION = utf8_general_ci
-DWITH_DEBUG = 0
-DENABLE_PROFILING = 1


如果想清理此前编译所生成的文件，则需要使用如下命令：
make clean
rm CMakeCache.txt


字符集：
人：


汉字，字符集：
GBK
GB2312
GB18030
UTF8


排序规则


性能分析

=========================

2.编译安装

# groupadd -r mysql
# useradd -g mysql -r -d /data/mydata mysql
# tar xf mysql-5.5.37.tar.gz
# cd mysql-5.5.37
# cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \
								 -DMYSQL_DATADIR=/data/mydata \
-DSYSCONFDIR=/etc \
-DWITH_INNOBASE_STORAGE_ENGINE=1 \
-DWITH_ARCHIVE_STORAGE_ENGINE=1 \
-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \
-DWITH_READLINE=1 \
-DWITH_SSL=system \
-DWITH_ZLIB=system \
-DWITH_LIBWRAP=0 \
-DMYSQL_UNIX_ADDR=/tmp/mysql.sock \
-DDEFAULT_CHARSET=utf8 \
-DDEFAULT_COLLATION=utf8_general_ci

# make
# make install


mysql - mysqld
Unix

-------------------------------------------------------------------
如果cmake选项写错了，或者中途报错了
那么就删除CMakeCache.txt文件，将选项修改正确，再重新执行cmake
-DCMAKE_INSTALL_PREFIX —— 软件安装位置
-DDEFAULT_CHARSET —— 指定默认字符集
-DENABLED_LOCAL_INFILE —— 支持将本地文件转换为数据库数据
-DMYSQL_DATADIR —— 数据的存放路径
-DWITH_EXTRA_CHARSET —— 附属字符集
-DWITH_READLINE —— 方便在命令行复制、粘贴命令等
-DWITH_INNOBASE_STORAGE_ENGINE —— 支持innodb存储引擎
-DMYSQL_TCP_PORT —— mysql服务的端口
-DDEFAULT_COLLATION —— 字符的配置、为了避免乱码
-------------------------------------------------------------------



服务器和客户端在同一台主机上使用mysql.sock 进行通信

服务器和哭护短不再同一个主机上，基于TCP/IP 协议进行通信

mysql --- mysql.sock ---- mysqld

Windows
mysql ---- memory(pipe) ----- mysqld



MySQL 客户端工具：
mysql
mysqldump
mysqladmin
mysqlcheck
mysqlimport

[client]

-u USERNAME
-h HOST
-p PASSWORD
--protocol {tcp|socket|pipe|memory}
--port PORT



MySQL 非客户端工具：
myisamchk
myisamack





cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DMYSQL_DATADIR=/mydata/data/ -DSYSCONFDIR=/etc -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_ARCHIVE_STORAGE_ENGINE=1 -DWITH_BLACKHOLE_STORAGE_ENGINE=1 -DWITH_READLINE=1 -DWITH_SSL=system -DWITH_ZLIB=system -DWITH_LIBWRAP=0 -DMYSQL_UNIX_ADDR=/tmp/mysql.sock -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci              

make
make install





mysql>

为用户设定密码

1.SET PASSWORD FOR 'USERNAME'@'HOST'=PASSWORD('password');      表示密码加密表示

flush privileges；                       刷新授权表，让mysql进程重读跟用户相关的表


更改密码
2.#   mysqladmin -uUSERNAME -hHOST -p password 'password'

mysqladmin -uroot -h127.0.0.1 -p password '123456'

mysql -uroot -p

UER mysql;

select User,Host,Password FROM user;


3.#  mysql> UPDATE user SET Password=Password('password') WHERE USER='root' AND Host=127.0.0.1;


AND
OR
NOT



允许管理员的权限

GRANT ALL PRIVILEGES ON *.* TO 'root'@'172.16.%.%'  IDENTIFIED BY 'redhat';

flush privileges;


常用的mysql客户端工具，图形客户端
1.phpMyAdmin
2.Workbench
3.MySQL Front
4.Navicat 


单层结构

三层结构



查看php能不能连上mysql 



MySQL:  配置文件格式，集中式配置文件，可以为多个程序提供配置
[mysql]
fdaf

[mysqld]
dfs

[client]
fsd

/etc/my.cnf  -------  /etc/mysql/my.cnf -----------  $BASEDIR/my.cnf  ---------- $DATADIR/my.cnf


MySQL 服务器维护了两类变量
服务器变量
定义MySQL 服务器运行特性
状态变量
保存了MySQL 服务器运行统计数据
SHOW GLOBAL VARIABLES;                  查看变量

MySQL 通配符
_: 任意单个字符
%: 任意长度的任意字符



#### MySQL目录结构

	/usr/local/mysql5.5  —— 软件的安装目录
bin：存放的是服务器和客户端的程序(命令)
	docs：文档           
	lib：存放库文件         
	README：简介  
	sql-bench：benchmarks性能测试
	COPYING：跟版权相关的
	include：存放的头文件
	man：man手册
	scripts：脚本目录
	support-files：模板文件
	data：存放数据的目录，我们指定了/data/mysql，那么这个目录就不再使用了
	INSTALL-BINARY ：mysql的安装文档
	mysql-test：mysql测试相关的
	share：共享路径及其他
	/data/mysql  —— 数据存放路径
	[root@s200 mysql]# ls
	ibdata1  ：系统自己命名的数据文件    
	mysql-bin.00000X ：二进制日志文件、主要用于备份恢复
	mysql-bin.index：二进制日志索引文件                 
	ib_logfile0和ib_logfile1：系统自己命名的日志文件         
	s200.uplooking.com.err：错误日志文件
	s200.uplooking.com.pid：pid文件
	mysql ：以下三个都是数据库，mysql是必须存在的       
	test
	performance_schema


#### 登录MySQL数据库

	MySQL默认情况下是支持匿名登录的
	一、匿名登录
	[root@s200 mysql]# mysql
	二、给root设置密码
	[root@s200 mysql]# mysqladmin -u root password "123456"
	[root@s200 mysql]# /etc/init.d/mysqld restart  //mysql5.6无此步骤
	三、本地登录
	[root@s200 mysql]# mysql -uroot -p
	Enter password:123456
	或者mysql -uroot -p123456   注意：-p后面一定没有空格
	四、远程登录
	[root@s200 mysql]# mysql -uroot -h 172.16.254.200 -p  //暂时无法执行，需要授权才行   

	-----------------------------------------------------------------------------------------    
	遇到的错误
	[root@saber mysql]# cd /data/mysql/
	[root@saber mysql]# tail -30f saber.err
	InnoDB: Check that you do not already have another mysqld process
	InnoDB: using the same InnoDB data or log files.
	InnoDB: Unable to lock ./ibdata1, error: 11
	分析：
	提示有另一个mysqld进程在运行，可能原因是mysql的进程开的太多了
	解决办法：
	[root@saber mysql]# ps -ef | grep mysql
	[root@saber mysql]# pkill mysqld
	[root@saber mysql]# pkill mysqld_safe
	[root@saber mysql]# ps -ef | grep mysql
	root     26914 26514  0 16:13 pts/5    00:00:00 grep mysql
	[root@saber mysql]# /etc/init.d/mysqld status
	MySQL is not running, but lock file (/var/lock/subsys/mysql[FAILED]
			[root@saber mysql]# rm /var/lock/subsys/mysql -f
			[root@saber mysql]# /etc/init.d/mysqld status
			MySQL is not running                                       [FAILED]
			[root@saber mysql]# /etc/init.d/mysqld start
			Starting MySQL...                                          [  OK  ]
			----------------------------------------------------------------------------------------- 


#### 查看数据库帮助

			官方网站：http://dev.mysql.com/doc

			MySQL获取客户端帮助  
			mysql> help或者?或者\h
			\c 清除当前输入的sql语句，注意一定要在没敲分号的时候使用
			exit quit \q   退出mysql
			source \. 执行sql脚本
			system  \!   执行shell命令
			mysql> \! ls /tmp
			use \u   使用另一个数据库

	MySQL获取服务器端的帮助
	mysql> help contents
	mysql> help data types
	mysql> help time


#### 数据库运算符

	1、算数运算符
	2、比较运算符
	3、逻辑运算符

	1、算数运算符
	+    -   *   /   % 
	mysql> select 1+2
	-> ;         // ->表示命令没输完
	mysql> select 1-2;
	mysql> select 2+3.4567;
	mysql> select 4*3,4/3,4/3.0;
	mysql> select 4/0;   //结果为null
	mysql> select 1+'2a';  //结果为3，字符串以数字开头，转换成数字
	mysql> select 1+'a2';  //结果为1，字符串以字母开头，转成数字0
	mysql> show warnings;    //查看警告信息
	+---------+------+----------------------------------------+
	| Level   | Code | Message                                |
	+---------+------+----------------------------------------+
	| Warning | 1292 | Truncated incorrect DOUBLE value: 'a2' |
	+---------+------+----------------------------------------+
1 row in set (0.00 sec)
	mysql> select power(2,3);        //2 的3次幂
	+------------+
	| power(2,3) |
	+------------+
	|          8 |
	+------------+
1 row in set (0.00 sec)

	2、比较运算符
	>   <   >=  <=  =     !=    <>      成立返回1，不成立返回0
	mysql> select 1>2;
	mysql> select 1<>2;
	mysql> select 'b'='B';    //返回1，默认不区分大小写
	mysql> select binary 'b'='B';  //返回0，想区分大小写，指定binary关键字

	3、逻辑运算符
	and    or    not
	mysql> select 4>3 and 'a'='A';
	mysql> select 4>3 or 'a'='B';
	mysql> select not 4<5;    

	练习脚本：
	编写mysql安装脚本，要求能够实现一执行脚本就能够将mysql安装完成并成功启动。 
