
MySQL
SQL/ MySQL

事务， 隔离， 并发控制， 锁
用户和权限
监控
STATUS
索引类型：查询
VARIABLE



DBMS
RDBMS

文件                                                          文件
数据冗余和不一致性                                   表示层
数据访问困难                                                  文件
数据孤立                                                    逻辑层
完整性问题                                                       
原子性问题                                                  物理层
并发访问异常                                                  元数据
安全性问题                                                      数据：数据块



DBMS
层次模型
网状模型
关系模型：关系模型

RDBMS


关系模型：（结构化数据模型）
关系模型
实体.关系模型
	对象关系模型：基于对象的数据模型
半结构化数据模型: XML(扩展标记语言)
	user:name
	age:
gender:

name:
uid:
birthday:

name: age:gender
name:uid:birthday

关系： 代数运算

70

System  R: SQL

Ingres: 关系型数据库      oracle   sybase


RDB对象：
库，表，索引，视图，用户，存储过程，存储函数，触发器，事件调度器

约束：230
域约束：数据类型约束
外键约束：引用完整性约束
主键约束：某字段能指示标志此字段所属的实体，并且不允许为空
唯一性约束： 每一行的某字段都不允许出现相同值，可以为空
一张表中可以有多个

检查行约束： age int

constraint:  约束      
自己定义约束关系（保证关系型数据是否成为关系型数据的关键概念）        





DML：数据操作语言
INSERT
DELETE
SELECT
UPDATE

DDL:  数据定义语言
CREATE
DROP
ALTER

DCL:    
GRANT
REVOKE


访问权限：






/etc/passwd:                      



shellid





关系型数据
表示层：表
逻辑层：存储引擎
物理层：数据文件



数据库是如何完成数据的存取和查询的？

存储管理器
数据查询和存储：
存储管理器：
权限管理
权限及完整性管理    

事物管理器
文件管理器
缓冲区管理器：管理缓冲空间  

查询管理器
DML解释器：
DDL解释器：
DCL解释器：
查询执行引擎        


DBA
应用程序    SQL用户     程序员



DDL：
DML：
DCL：






C.S

MySQL：单线程多进程的

单进程：
守护线程

应用线程
10个用户
256M
1G
256M



关系运算
投影：只输出指定属性
选择：只输出符合条件的行
自然连接：具有相同名字的所有属性取值相同的行
笛卡儿积：
(a+b)*(c+d) = ac+ad+bc+bd

并:  集合运算





MySQL 服务器的体系结构        




SQL 查询语句
seque1 -- SQL
SQL - 86
SQL - 89
SQL - 92
SQL - 99
SQL - 03
SQL - 08



SQL：语言的组成部分
DDL
DML
完整性定义语言：DDL的一部分功能
视图定义
事物控制
嵌入式SQL和动态SQL：
授权：DCL


学习高级select语句的用法


使用程序设计语言如何跟RDBMS交互
嵌入式SQL：与动态SQL类似，但其语言必须程序编译时完全确定下来
ODBC

动态SQL：程序设计语言使用函数（mysql_connect()）或者方法与RDBMS服务器建立
连接，并进行交互，通过建立
连接向SQL服务器发送查询语句，并将结果保存至变量中进行处理
JDBC



连接管理器

缓存          解析器

优化器

数据文件    索引文件    日志文件

My1SAM  ： 不支持事物

InnoDB：支持事物




用户连接请求
|
连接管理器
|
线程管理器
|
用户模块（管理用户连接的）    
|
日志  ------------------- 命令分发模块 -------------  告诉缓存模块  ---- （缓存管理器）
|                        
解析器
|
|
repair 
优化器   表定义  表维护     状态报告  复制
模块       模块        模块      模块
|           |            |             |            |                
|           |            |             |            |                       
|           |            |             |            |               
访问控制模块            
|      
表管理器
|
存储引擎





表管理器：负责创建，读取或修改表定义文件
表结构定义文件

表修改模块：创建表，删除，重命名，移除，更新或插入之类的操作
表维护模块：检查， 修改， 备份， 恢复， 优化（碎片整理）及解析


文件中记录组织：
堆文件组织：一条记录可以放在文件中的任何地方
顺序文件组织：根据"搜索码"值顺序存放
散列文件组织：


数据字典
关系的元数据
关系的名字
字段名字
字段的类型和长度
视图
约束

用户名：授权，密码


缓冲区管理器：
和存储相关



MySQL特性

Speed  
完全多线程
查询缓存

Reliability
Scalability （伸缩性）
Ease of use
Portability and Standards Compliance
Multiuser Support
Internationalization
Wide Application Support
C C++ java perl PHP Python Ruby
JDBC ODBC 


MySQL Server （mysqld，mysql）                         
MySQL Cluster
MySQL Proxy
MySQL administrator
MySQL Query Browser
MySQL Workbench
MySQL Migration Toolkit
MySQL Embedded Server
MySQL Drivers and Connextors



Contribute to MySQL server

Blogging
Mailing lists
User groups
Documentation
Code
MySQL Magazine


MySQL
MariaDB
Percona

MySQL的常用安装
专用的软件包管理器包
deb， rpm
rpm：
RHEL（Oracle linux） CentOS
SUSE
通用二进制格式包
gcc：x86， x64
源代码
5.1，  5.5 ， 5.6
cmake  （跨平台的编译器）



bin

data

include
lib
man
mysql-test
scripts             
share                   语言共享库（每一种语言相关的不同版本）
sql-bench               基准测试（能够测试mysql服务器安装完成后的负载能力）
support-files           


/etc/my.cnf
/etc/mysql/my.cnf
$MYSQL_HOME/my.cnf
/path/to/file when defaults-extra-file=/path/to/
~/.my.cnf

MySQL 用户密码修改：
1. # mysqladmin -u USERNAME -H HOSTNAME password 'new_password' -p
2. mysql> SET PASSWORD FRO 'USERNAME'@'HOST'=PASSWORD('new_pass');
3. mysql> UPDATE mysql.user SET PASSWORD=PASSWORD('new_pass') WHERE CONDITION;
4. mysql> flush privileges;


安装一个mysql  功能使用

原码安装mysql

1.使用cmake编译mysql-5.5
cmake 指定编译选项的方式不同于make， 实现方式对比如下：
./configure         cmake . 
./configure --help    cmake . -LAH  or  ccmake . 

指定安装文件的安装路径时常用的选项：
-DCMAKE_INSTALL_PREFIX=/usr/local/mysql
-DMYSQL_DATADIR=/data/mysql
-DSYSCONFDIR=/etc

默认编译的存储引擎包括： csv， myisam， myisamerg 和 help
若要安装其他存储引擎，可以使用
类似如下编译选项：

-DWITH_INNOBASE_STORAGE_ENGINE = 1
-DWITH_ARCHIVE_STORAGE_ENGINE = 1
-DWITH_BLACKHOLE_STORAGE_ENGINE = 1
-DWITH_FEDERATED_STORAGE_ENGINE = 1

若要明确指定不编译某存储引擎，可以使用类似如下的选项
-DWITHOUT_<ENGINE>_STORAGE_ENGINE = 1
比如：
-DWITHOUT_EXAMPLE_STORAGE_ENGINE = 1
-DWITHOUT_FEDERATED_STORAGE_ENGINE = 1
-DWITHOUT_PARTITION_STORAGE_ENGINE = 1

如若要编译进其它功能，如ssl 等， 则可使用类似如下选项来实现编译时
使用某库或不使用某库
-DWITH_TCP_PORT = 3306
-DMYSQL_UNIX_ADDR = /tmp/mysql.sock
-DENABLED_LOCAL_INFILE = 1
-DEXTRA_CHARSETS = all
-DDEFAULT_CHARSET = utf8
-DDEFAULT_COLLATION = utf8_general_ci
-DWITH_DEBUG = 0
-DENABLE_PROFILING = 1


如果想清理此前编译所生成的文件，则需要使用如下命令：
make clean
rm CMakeCache.txt


字符集：
人：


汉字，字符集：
GBK
GB2312
GB18030
UTF8


排序规则


性能分析

=========================

2.编译安装

# groupadd -r mysql
# useradd -g mysql -r -d /data/mydata mysql
# tar xf mysql-5.5.37.tar.gz
# cd mysql-5.5.37
# cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \
								 -DMYSQL_DATADIR=/data/mydata \
-DSYSCONFDIR=/etc \
-DWITH_INNOBASE_STORAGE_ENGINE=1 \
-DWITH_ARCHIVE_STORAGE_ENGINE=1 \
-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \
-DWITH_READLINE=1 \
-DWITH_SSL=system \
-DWITH_ZLIB=system \
-DWITH_LIBWRAP=0 \
-DMYSQL_UNIX_ADDR=/tmp/mysql.sock \
-DDEFAULT_CHARSET=utf8 \
-DDEFAULT_COLLATION=utf8_general_ci

# make
# make install


mysql - mysqld
Unix

服务器和客户端在同一台主机上使用mysql.sock 进行通信

服务器和哭护短不再同一个主机上，基于TCP/IP 协议进行通信

mysql --- mysql.sock ---- mysqld

Windows
mysql ---- memory(pipe) ----- mysqld



MySQL 客户端工具：
mysql
mysqldump
mysqladmin
mysqlcheck
mysqlimport

[client]

-u USERNAME
-h HOST
-p PASSWORD
--protocol {tcp|socket|pipe|memory}
--port PORT



MySQL 非客户端工具：
myisamchk
myisamack





cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DMYSQL_DATADIR=/mydata/data/ -DSYSCONFDIR=/etc -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_ARCHIVE_STORAGE_ENGINE=1 -DWITH_BLACKHOLE_STORAGE_ENGINE=1 -DWITH_READLINE=1 -DWITH_SSL=system -DWITH_ZLIB=system -DWITH_LIBWRAP=0 -DMYSQL_UNIX_ADDR=/tmp/mysql.sock -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci              

make
make install




mysql>

为用户设定密码

1.SET PASSWORD FOR 'USERNAME'@'HOST'=PASSWORD('password');      表示密码加密表示

flush privileges；                       刷新授权表，让mysql进程重读跟用户相关的表


更改密码
2.#   mysqladmin -uUSERNAME -hHOST -p password 'password'

mysqladmin -uroot -h127.0.0.1 -p password '123456'

mysql -uroot -p

UER mysql;

select User,Host,Password FROM user;


3.#  mysql> UPDATE user SET Password=Password('password') WHERE USER='root' AND Host=127.0.0.1;


AND
OR
NOT



允许管理员的权限

GRANT ALL PRIVILEGES ON *.* TO 'root'@'172.16.%.%'  IDENTIFIED BY 'redhat';

flush privileges;


常用的mysql客户端工具，图形客户端
1.phpMyAdmin
2.Workbench
3.MySQL Front
4.Navicat 


单层结构

三层结构



查看php能不能连上mysql 



MySQL:  配置文件格式，集中式配置文件，可以为多个程序提供配置
[mysql]
fdaf

[mysqld]
dfs

[client]
fsd

/etc/my.cnf  -------  /etc/mysql/my.cnf -----------  $BASEDIR/my.cnf  ---------- $DATADIR/my.cnf


MySQL 服务器维护了两类变量
服务器变量
定义MySQL 服务器运行特性
状态变量
保存了MySQL 服务器运行统计数据
SHOW GLOBAL VARIABLES;                  查看变量

MySQL 通配符
_: 任意单个字符
%: 任意长度的任意字符




